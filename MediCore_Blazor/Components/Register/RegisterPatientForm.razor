@using MediCore_Library.Models.Identities

<EditForm Model="Request" OnValidSubmit="OnSubmit">
	<DataAnnotationsValidator />
	<ValidationSummary />

	<div>
		<label>Email</label>
		<InputText @bind-Value="Request.Email" />
	</div>
	<div>
		<label>Password</label>
		<InputText @bind-Value="Request.Password" />
	</div>
	<div>
		<label>First Name</label>
		<InputText @bind-Value="Request.Patient!.FirstName" />
	</div>
	<div>
		<label>Last Name</label>
		<InputText @bind-Value="Request.Patient.LastName" />
	</div>
	<div>
		<label>Gender</label>
		<InputText @bind-Value="Request.Patient.Gender" />
	</div>
	<div>
		<label>Date of Birth</label>
		<InputDate @bind-Value="date" min="@DateTime.Today.AddYears(-120).ToString("yyyy-MM-dd")" max="@DateTime.Today.ToString("yyyy-MM-dd")" />
	</div>
	<div>
		<label>Phone Number</label>
		<InputText @bind-Value="Request.Patient.PhoneNumber" />
	</div>
	<div>
		<label>Street</label>
		<InputText @bind-Value="Request.Patient.Address!.Street" />
	</div>
	<div>
		<label>City</label>
		<InputText @bind-Value="Request.Patient.Address.City" />
	</div>
	<div>
		<label>Province or State</label>
		<InputText @bind-Value="Request.Patient.Address.ProvinceOrState" />
	</div>
	<div>
		<label>Country</label>
		<InputText @bind-Value="Request.Patient.Address.Country" />
	</div>
	<div>
		<label>Postal Code</label>
		<InputText @bind-Value="Request.Patient.Address.PostalCode" />
	</div>
	<div>
		<button type="submit">Register</button>
	</div>
</EditForm>

@code {
	[Parameter]
	public Register Request { get; set; } = new();

	[Parameter]
	public EventCallback OnSubmit { get; set; }

	private DateTime date { get; set; } = new DateTime(2000,1,1);

	private async Task HandleSubmit()
	{
		Request.Doctor = null;
		Request.Staff = null;
		Request.Patient!.DateOfBirth = DateOnly.FromDateTime(date);

		if (OnSubmit.HasDelegate)
		{
			await OnSubmit.InvokeAsync();
		}
	}
}
